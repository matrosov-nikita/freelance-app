!function(e){"use strict";var i=e.module("lfNgMdFileInput",["ngMaterial"]);i.filter("lfTrusted",["$sce",function(e){return function(i){return e.trustAsResourceUrl(i)}}]),i.directive("lfNgMdFileInput",["$q","$compile",function(i,l){return{restrict:"E",template:['<div layout="column" class="lf-ng-md-file-input">','<div layout="column" class="lf-ng-md-file-input-preview-container" ng-class="{\'disabled\':isDisabled}" ng-show="isDrag || (isPreview && !isFilesNull)">','<div class="close lf-ng-md-file-input-x" ng-click="removeAllFiles($event)" ng-hide="isFilesNull" >&times;</div>','<div class="lf-ng-md-file-input-drag">','<div layout="row" layout-align="center center" class="lf-ng-md-file-input-drag-text-container" ng-show="isFilesNull && isDrag">','<div class="lf-ng-md-file-input-drag-text">{{strCaptionDragAndDrop}}</div>',"</div>",'<div class="lf-ng-md-file-input-thumbnails">',"</div>",'<div class="clearfix" style="clear:both"></div>',"</div>","</div>",'<div layout="row" class="lf-ng-md-file-input-container" >','<div class="lf-ng-md-file-input-caption" layout="row" layout-align="start center" flex ng-class="{\'disabled\':isDisabled}" >','<md-icon class="lf-icon" ng-class="strCaptionIconCls"></md-icon>','<div flex class="lf-ng-md-file-input-caption-text-default" ng-show="isFilesNull">',"{{strCaptionPlaceholder}}","</div>",'<div flex class="lf-ng-md-file-input-caption-text" ng-hide="isFilesNull">',"{{strCaption}}","</div>","</div>",'<md-button ng-disabled="isDisabled" ng-click="removeAllFiles()" ng-hide="isFilesNull" class="md-raised lf-ng-md-file-input-button lf-ng-md-file-input-button-remove" >','<md-icon class="lf-icon" ng-class="strRemoveIconCls"></md-icon> ',"{{strCaptionRemove}}","</md-button>",'<md-button ng-disabled="isDisabled" class="md-raised md-primary lf-ng-md-file-input-button lf-ng-md-file-input-button-brower" >','<md-icon class="lf-icon" ng-class="strBrowseIconCls"></md-icon> ',"{{strCaptionBrowse}}",'<input type="file" accept="{{accept}}" ng-disabled="isDisabled" class="lf-ng-md-file-input-tag" onchange="angular.element(this).scope().onFileChanged(this)"/>',"</md-button>","</div>","</div>"].join(""),replace:!0,scope:{lfFiles:"=?",lfApi:"=?",lfOption:"=?",lfPlaceholder:"@?",lfDragAndDropLabel:"@?",lfBrowseLabel:"@?",lfRemoveLabel:"@?",accept:"@?",ngDisabled:"=?"},link:function(n,t,s){var o=e.element(t[0].querySelector(".lf-ng-md-file-input-tag")),a=e.element(t[0].querySelector(".lf-ng-md-file-input-drag")),r=e.element(t[0].querySelector(".lf-ng-md-file-input-thumbnails"));n.isPreview=!1,n.isDrag=!1,n.isMutiple=!1,"preview"in s&&(n.isPreview=!0),"drag"in s&&(n.isDrag=!0),"multiple"in s?(o.attr("multiple","multiple"),n.isMutiple=!0):o.removeAttr("multiple"),n.isDisabled=!1,e.isDefined(s.ngDisabled)&&n.$watch(function(){return n.ngDisabled},function(e){n.isDisabled=e}),n.strBrowseIconCls="lf-browse",n.strRemoveIconCls="lf-remove",n.strCaptionIconCls="lf-caption",n.strUnknowIconCls="lf-unknow",e.isDefined(s.lfOption)&&e.isObject(n.lfOption)&&(n.lfOption.hasOwnProperty("browseIconCls")&&(n.strBrowseIconCls=n.lfOption.browseIconCls),n.lfOption.hasOwnProperty("removeIconCls")&&(n.strRemoveIconCls=n.lfOption.removeIconCls),n.lfOption.hasOwnProperty("captionIconCls")&&(n.strCaptionIconCls=n.lfOption.captionIconCls),n.lfOption.hasOwnProperty("unknowIconCls")&&(n.strUnknowIconCls=n.lfOption.unknowIconCls)),n.accept=n.accept||"",n.lfFiles=[],n.lfApi=new function(){var e=this;e.removeAll=function(){n.removeAllFiles()}},n.isFilesNull=!0,n.strCaption="",n.strCaptionPlaceholder="Select file",n.strCaptionDragAndDrop="Drag & drop files here...",n.strCaptionBrowse="Browse",n.strCaptionRemove="Remove",n.lfPlaceholder&&(n.strCaptionPlaceholder=n.lfPlaceholder),n.lfDragAndDropLabel&&(n.strCaptionDragAndDrop=n.lfDragAndDropLabel),n.lfBrowseLabel&&(n.strCaptionBrowse=n.lfBrowseLabel),n.lfRemoveLabel&&(n.strCaptionRemove=n.lfRemoveLabel),a.bind("dragover",function(e){e.stopPropagation(),e.preventDefault(),!n.isDisabled&&n.isDrag&&a.addClass("lf-ng-md-file-input-drag-hover")}),a.bind("dragleave",function(e){e.stopPropagation(),e.preventDefault(),!n.isDisabled&&n.isDrag&&a.removeClass("lf-ng-md-file-input-drag-hover")}),a.bind("drop",function(e){if(e.stopPropagation(),e.preventDefault(),!n.isDisabled&&n.isDrag){a.removeClass("lf-ng-md-file-input-drag-hover");var i=e.target.files||e.dataTransfer.files;if(!(i.length<=0)){var l=n.lfFiles.map(function(e){return e.lfFileName}),t=new RegExp(n.accept,"i");if(n.isMutiple)for(var s=0;s<i.length;s++){var o=i[s];o.type.match(t)&&-1==l.indexOf(o.name)&&setTimeout(f(o),100*s)}else for(var s=0;s<i.length;s++){var o=i[s];if(o.type.match(t)&&-1==l.indexOf(o.name)){n.removeAllFiles(),setTimeout(f(o),100*s);break}}}}}),n.removeAllFiles=function(e){n.isDisabled||(n.lfFiles=[],r.empty(),d())},n.removeFileByName=function(i){n.isDisabled||(n.lfFiles.every(function(e,l){return e.lfFileName==i?(n.lfFiles.splice(l,1),!1):!0}),event&&e.element(event.target).parent().remove(),d())},n.onFileChanged=function(e){var i=e.files,l=n.lfFiles.map(function(e){return e.lfFileName});if(!(i.length<=0)){if(n.isMutiple)for(var t=0;t<i.length;t++){var s=i[t],a=1;-1==l.indexOf(s.name)&&(setTimeout(f(s),100*a),a++)}else for(var t=0;t<i.length;t++){var s=i[t];if(-1==l.indexOf(s.name)){n.removeAllFiles(),setTimeout(f(s),100);break}}o.val("")}};var f=function(i){g(i).then(function(t){var s=i,o=i.name,a=i.type,f=c(i),u=window.URL.createObjectURL(i);n.lfFiles.push({lfFile:s,lfFileName:o,lfDataUrl:u});var p=e.element('<div class="lf-ng-md-file-input-frame"></div>'),m=e.element('<div class="lf-ng-md-file-input-x" ng-click="removeFileByName(\''+i.name+"',$event)\">&times;</div>"),g="";g="image"==f?'<img src="'+u+'" >':"video"==f?["<video controls>",'<source src="'+u+'" type="'+a+'">',"</video>"].join(""):"audio"==f?["<audio controls>",'<source src="'+u+'" type="'+a+'">',"</audio>"].join(""):['<object data="'+u+'" type="'+a+'"><param name="movie" value="'+s.name+'" />','<div class="lf-ng-md-file-input-preview-default">','<md-icon class="lf-ng-md-file-input-preview-icon" ng-class="strUnknowIconCls"></md-icon>',"</div>","</object>"].join("");var v=e.element(g),b=e.element('<div class="lf-ng-md-file-input-frame-footer"><div class="lf-ng-md-file-input-frame-caption">'+s.name+"</div></div>");p.append(m),p.append(v),p.append(b),l(p)(n),r.append(p),d()},function(e){},function(e){})},d=function(){1==n.lfFiles.length?(n.strCaption=""+n.lfFiles[0].lfFileName,n.isFilesNull=!1):n.lfFiles.length>1?(n.strCaption=""+n.lfFiles.length+" files selected",n.isFilesNull=!1):(n.strCaption="",n.isFilesNull=!0)},c=function(e){var i=e.type,l=e.name;return u(i,l)?"image":p(i,l)?"video":m(i,l)?"audio":"object"},u=function(e,i){return e.match("image.*")||i.match(/\.(gif|png|jpe?g)$/i)?!0:!1},p=function(e,i){return e.match("video.*")||i.match(/\.(og?|mp4|webm|3gp)$/i)?!0:!1},m=function(e,i){return e.match("audio.*")||i.match(/\.(ogg|mp3|wav)$/i)?!0:!1},g=function(e,l){var n=i.defer(),t=new FileReader;return t.onloadstart=function(){n.notify(0)},t.onload=function(e){},t.onloadend=function(e){n.resolve({index:l,result:t.result})},t.onerror=function(e){n.reject(t.result)},t.onprogress=function(e){n.notify(e.loaded/e.total)},t.readAsArrayBuffer(e),n.promise}}}}])}(window.angular);